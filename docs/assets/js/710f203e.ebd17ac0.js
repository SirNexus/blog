"use strict";(self.webpackChunkaidan_blog=self.webpackChunkaidan_blog||[]).push([[659],{528:e=>{e.exports=JSON.parse('{"permalink":"/blog/istio-pod-to-pod-mtls","source":"@site/blog/2025-04-29-istio-pod-to-pod-mtls.md","title":"Enabling pod to pod mTLS in Istio","description":"Imagine a situation where you have multiple different clusters, each running","date":"2025-04-29T00:00:00.000Z","tags":[{"inline":true,"label":"Istio","permalink":"/blog/tags/istio"},{"inline":true,"label":"ServiceEntry","permalink":"/blog/tags/service-entry"},{"inline":true,"label":"pod","permalink":"/blog/tags/pod"},{"inline":true,"label":"mTLS","permalink":"/blog/tags/m-tls"},{"inline":true,"label":"strict","permalink":"/blog/tags/strict"},{"inline":true,"label":"authentication","permalink":"/blog/tags/authentication"}],"readingTime":13.73,"hasTruncateMarker":true,"authors":[{"name":"Aidan Carson","key":"aidancarson","page":null}],"frontMatter":{"slug":"istio-pod-to-pod-mtls","title":"Enabling pod to pod mTLS in Istio","authors":"aidancarson","tags":["Istio","ServiceEntry","pod","mTLS","strict","authentication"],"toc_min_heading_level":2,"toc_max_heading_level":5},"unlisted":false,"prevItem":{"title":"Networking Multiple Kind Kubernetes Clusters Together Using Native Routing","permalink":"/blog/kind-multi-cluster-flat-network"}}')},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>s});var o=n(6540);const i={},a=o.createContext(i);function r(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(a.Provider,{value:t},e.children)}},8612:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var o=n(528),i=n(4848),a=n(8453);const r={slug:"istio-pod-to-pod-mtls",title:"Enabling pod to pod mTLS in Istio",authors:"aidancarson",tags:["Istio","ServiceEntry","pod","mTLS","strict","authentication"],toc_min_heading_level:2,toc_max_heading_level:5},s="Enabling pod to pod mTLS in Istio",l={authorsImageUrls:[void 0]},c=[{value:"Context",id:"context",level:2}];function d(e){const t={code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Imagine a situation where you have multiple different clusters, each running\nan Istio service mesh and which are federated together to talk to each other.\nNow also imagine that these clusters are networked together such that each\npod IP is uniquely addressable and able to be communicated with from any other\ncluster."}),"\n",(0,i.jsx)(t.h2,{id:"context",children:"Context"}),"\n",(0,i.jsx)(t.p,{children:"I faced a situation like this, where I needed to group endpoints into logical\nhostnames that represented services backed by those endpoints. Because endpoints\ncould live anywhere, in any cluster, I landed on using a ServiceEntry to register\nthe hostname and WorkloadEntries to represent the endpoints service that hostname."}),"\n",(0,i.jsx)(t.p,{children:"But a problem came on enabling PeerAuthentication:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"apiVersion: security.istio.io/v1\nkind: PeerAuthentication\nmetadata:\n  name: default\n  namespace: prod-istio-system # The namespace of our istio installation\nspec:\n  mtls:\n    mode: STRICT\n"})}),"\n",(0,i.jsx)(t.p,{children:"Curl stopped working!"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"$ curl global-echo\nupstream connect error or disconnect/reset before headers. reset reason: connection termination\n"})}),"\n",(0,i.jsx)(t.p,{children:"Through some debugging, I was able to get it to:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"$ curl global-echo\nupstream connect error or disconnect/reset before headers. retried and the latest reset reason: remote connection failure, \ntransport failure reason: TLS_error:|268435581:SSL routines:OPENSSL_internal:CERTIFICATE_VERIFY_FAILED:TLS_error_end\n"})}),"\n",(0,i.jsx)(t.p,{children:"But to find the true root cause and solution took some digging."}),"\n",(0,i.jsx)(t.p,{children:"Let's get into it"})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);